<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Eski≈üehir UTMB¬Æ Strateji Portalƒ±</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRS9BMY=" crossorigin="" />
  
  <style>
    :root {
      --bg-dark: #090a0c;
      --sidebar-bg: #121418;
      --accent: #e94e1b;
      --accent-glow: rgba(233, 78, 27, 0.4);
      --text-main: #ffffff;
      --text-muted: #8b949e;
      --border: #2a2f38;
      --card-bg: #161b22;
      --safe-area-top: env(safe-area-inset-top);
      --safe-area-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; padding: 0;
      background-color: var(--bg-dark);
      font-family: 'Inter', sans-serif;
      color: var(--text-main);
      height: 100vh; display: flex; flex-direction: column; overflow: hidden;
    }

    /* HEADER */
    header {
      height: 60px; background: rgba(18, 20, 24, 0.95);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; padding: 0 24px;
      justify-content: space-between; flex-shrink: 0; z-index: 30;
      padding-top: var(--safe-area-top);
    }
    .brand { font-weight: 800; font-size: 18px; display: flex; align-items: center; gap: 12px; color: white; }
    .brand-icon { width: 24px; height: 24px; background: var(--accent); border-radius: 4px; display: grid; place-items: center; font-size: 12px; }
    .brand span { color: var(--accent); }
    .header-center-title {
        position: absolute; left: 50%; transform: translateX(-50%);
        font-weight: 900; font-size: 14px; text-transform: uppercase;
        letter-spacing: 2px; color: white; border: 1px solid var(--accent);
        padding: 4px 15px; border-radius: 50px; background: rgba(0,0,0,0.6);
    }
    .header-center-title span { color: var(--accent); }

    /* LAYOUT */
    .layout { display: flex; flex: 1; height: calc(100vh - 60px); overflow: hidden; position: relative; }

    /* SIDEBAR */
    aside {
      width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border);
      display: flex; flex-direction: column; z-index: 20;
    }
    .scrollable-list { flex: 1; overflow-y: auto; padding: 20px 10px; }
    .menu-item {
      padding: 12px; margin-bottom: 4px; cursor: pointer; color: #9ca3af;
      font-size: 13px; font-weight: 500; display: flex; align-items: center;
      gap: 10px; border-radius: 8px; transition: all 0.2s;
    }
    .menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
    .menu-item.active { background: rgba(233, 78, 27, 0.15); color: white; border: 1px solid rgba(233, 78, 27, 0.3); }
    .sidebar-footer { padding: 20px; border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 12px; }

    /* BUTTONS */
    .nav-btn-main {
        width: 100%; background: linear-gradient(45deg, #cc4416, #e94e1b);
        border: none; color: white; padding: 14px; border-radius: 12px;
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        gap: 8px; font-weight: 800; font-size: 13px; transition: 0.2s;
    }
    .nav-btn-main:active { transform: scale(0.96); }
    .nav-btn-main:not(.active) { background: rgba(255,255,255,0.05); border: 1px solid var(--border); opacity: 0.8; }
    .nav-btn-main.active { opacity: 1; border: 1px solid var(--accent); box-shadow: 0 4px 15px rgba(233,78,27,0.4); }
    .nav-btn-tv { background: linear-gradient(45deg, #1a1a1a, #333); }
    .nav-btn-strategy { background: linear-gradient(45deg, #1a1f26, #2a2f38); }

    /* MAIN AREA & VIEWS */
    main { flex: 1; background: var(--bg-dark); position: relative; overflow: hidden; }

    /* CRITICAL FIX: DISPLAY NONE instead of OPACITY */
    .view-section {
        display: none; /* Gizli */
        flex-direction: column;
        width: 100%; height: 100%;
        padding: 30px; overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }
    .view-section.active-view {
        display: flex; /* G√∂r√ºn√ºr */
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* DASHBOARD & GRIDS */
    .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
    .dash-title h1 { margin: 0; font-size: 24px; font-weight: 300; }
    .dash-title span { font-weight: 800; color: var(--accent); }
    .events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; padding-bottom: 50px; }
    .event-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 15px; height: 140px; display: flex; flex-direction: column; justify-content: space-between; }
    
    /* STRATEGY & MAP */
    .strategy-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
    .stat-card { background: linear-gradient(145deg, #1a1f26, #161b22); border: 1px solid rgba(255,255,255,0.05); border-left: 3px solid var(--accent); border-radius: 12px; padding: 20px; }
    
    #raceMap {
        height: 400px; width: 100%; border-radius: 12px; border: 1px solid var(--border);
        background: #222; /* Y√ºklenirken gri g√∂r√ºnmesin */
    }
    .map-wrapper { background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border); }

    /* SLIDE VIEWER */
    .slide-viewer-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%; position: relative; }
    .viewer-frame { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; position: relative; }
    img#currentSlide { max-width: 100%; max-height: 100%; object-fit: contain; }
    .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); color: white; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; }
    .nav-btn.prev { left: 10px; } .nav-btn.next { right: 10px; }

    /* MOBILE */
    @media (max-width: 768px) {
      .layout { flex-direction: column; }
      header { padding: 0 15px; height: 50px; }
      .brand { font-size: 14px; max-width: 60%; }
      .header-center-title { position: static; transform: none; font-size: 10px; margin-left: auto; }
      aside { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border); flex-direction: column; padding: 0; order: -1; }
      .sidebar-footer { padding: 8px; border-top: none; flex-direction: row; gap: 6px; order: 1; overflow-x: auto; }
      .nav-btn-main { padding: 8px 6px; font-size: 10px; min-width: 90px; }
      .scrollable-list { display: flex; flex-direction: row; overflow-x: auto; padding: 5px 10px; gap: 8px; width: 100%; scroll-snap-type: x mandatory; order: 2; }
      .menu-item { min-width: 120px; margin: 0; flex-direction: column; justify-content: center; text-align: center; height: 60px; scroll-snap-align: start; }
      .view-section { padding: 15px; padding-bottom: 80px; }
      .nav-btn { display: none; }
      #raceMap { height: 300px; }
    }
  </style>
</head>
<body>

  <header>
    <div class="brand"><div class="brand-icon">‚ûú</div> UTMB¬Æ <span>Eski≈üehir</span></div>
    <div class="header-center-title">ALƒ∞ <span>G√ú√áL√ú</span></div>
  </header>

  <div class="layout">
    <aside>
      <div class="sidebar-footer" style="order: 1;">
          <button class="nav-btn-main" id="btnHome" onclick="switchView('dashboard')"><span>üåç</span> K√úRESEL TAKVƒ∞M</button>
          <button class="nav-btn-main nav-btn-tv" id="btnTv" onclick="switchView('tv')"><span>üì∫</span> UTMB¬Æ TV</button>
          <button class="nav-btn-main nav-btn-strategy" id="btnStrategy" onclick="switchView('strategy')"><span>üìä</span> STRATEJƒ∞ & HARƒ∞TA</button>
          <button class="nav-btn-main" id="btnPodcast" onclick="togglePodcast()"><span>üéôÔ∏è</span> PODCAST</button>
      </div>
      <div class="scrollable-list" style="order: 2;">
        <ul class="menu-list" id="menuList" style="display:contents;"></ul>
      </div>
    </aside>

    <main id="mainArea">
      
      <div id="slideView" class="view-section active-view">
          <div class="slide-viewer-container">
            <div class="viewer-frame">
                <button class="nav-btn prev" id="btnPrev">‚ùÆ</button>
                <img id="currentSlide" src="" alt="Sunum">
                <button class="nav-btn next" id="btnNext">‚ùØ</button>
            </div>
            <div style="text-align:center; color:#666; font-size:11px; margin-top:10px;">
                <span id="slideCounter"></span> - <span id="slideName"></span>
            </div>
          </div>
      </div>

      <div id="dashboardView" class="view-section">
          <div class="dash-header"><div class="dash-title"><h1>UTMB¬Æ <span>Series</span></h1></div></div>
          <div class="events-grid" id="events-container"></div>
      </div>

      <div id="tvView" class="view-section">
        <div class="dash-header"><div class="dash-title"><h1>UTMB¬Æ <span>TV</span></h1></div></div>
        <iframe width="100%" height="300" src="https://www.youtube.com/embed/Q4HzcbK730A" frameborder="0" allowfullscreen></iframe>
      </div>

      <div id="strategyView" class="view-section">
          <div class="dash-header"><div class="dash-title"><h1>PROJE <span>HARƒ∞TASI</span></h1></div></div>
          
          <div class="map-wrapper">
              <h3 style="color:white; margin-top:0;">üìç PARKUR HARƒ∞TASI (v7.7 Fix)</h3>
              <div id="raceMap"></div>
          </div>

          <div class="strategy-grid">
              <div class="stat-card">
                  <h3 style="color:#aaa;">LOGƒ∞STƒ∞K</h3>
                  <div style="font-size:24px; font-weight:bold; color:white;">YHT & HAVALƒ∞MANI</div>
                  <div style="color:#888; font-size:12px;">Ankara ve ƒ∞stanbul'a hƒ±zlƒ± eri≈üim.</div>
              </div>
              <div class="stat-card">
                  <h3 style="color:#aaa;">PARKUR</h3>
                  <div style="font-size:24px; font-weight:bold; color:#4caf50;">100K / 4000m+</div>
                  <div style="color:#888; font-size:12px;">S√ºndiken ve Frig Vadisi rotalarƒ±.</div>
              </div>
          </div>
      </div>

    </main>
  </div>

  <audio id="audioPlayer" src="assets/slide_03_audio.m4a" preload="auto"></audio>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    // --- VERƒ∞LER ---
    const slidesData = [
      { file: "assets/slide_01.webp", title: "Kapak: Vizyon" },
      { file: "assets/slide_02.webp", title: "UTMB¬Æ Nedir?" }, 
      { file: "assets/slide_03.webp", title: "Ekonomik Etki" },
      { file: "assets/slide_12.webp", title: "Yol Haritasƒ±" }
    ];

    const utmbEvents = [
        { name: "Dacia UTMB¬Æ Mont-Blanc", location: "Chamonix üá´üá∑", date: "Aƒüustos", tag: "FINALS" },
        { name: "Cappadocia Ultra-Trail¬Æ", location: "T√ºrkiye üáπüá∑", date: "Ekim", tag: "EVENT" },
        { name: "Val d'Aran by UTMB¬Æ", location: "ƒ∞spanya üá™üá∏", date: "Temmuz", tag: "MAJOR" }
    ];

    // DEƒûƒ∞≈ûKENLER
    let currentIndex = 0;
    let map = null; // Harita deƒüi≈ükeni global
    const imgEl = document.getElementById('currentSlide');
    
    // NAVIGATION
    function switchView(viewName) {
        // Hepsini Gizle
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
        document.querySelectorAll('.nav-btn-main').forEach(el => el.classList.remove('active'));

        // ƒ∞lgili Olanƒ± A√ß
        if(viewName === 'dashboard') {
            document.getElementById('dashboardView').classList.add('active-view');
            document.getElementById('btnHome').classList.add('active');
        } 
        else if(viewName === 'tv') {
            document.getElementById('tvView').classList.add('active-view');
            document.getElementById('btnTv').classList.add('active');
        } 
        else if(viewName === 'strategy') {
            document.getElementById('strategyView').classList.add('active-view');
            document.getElementById('btnStrategy').classList.add('active');
            
            // HARƒ∞TAYI Y√úKLE (Kritik Nokta)
            setTimeout(() => {
                initMap(); 
            }, 100); 
        }
    }

    // SLIDE FONKSƒ∞YONLARI
    function showSlide(index) {
        if(index < 0) index = 0;
        if(index >= slidesData.length) index = slidesData.length - 1;
        currentIndex = index;
        
        // Slayt view'i a√ß
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
        document.getElementById('slideView').classList.add('active-view');
        
        imgEl.src = slidesData[currentIndex].file;
        document.getElementById('slideCounter').innerText = (currentIndex + 1) + "/" + slidesData.length;
        document.getElementById('slideName').innerText = slidesData[currentIndex].title;
    }

    // BUTON EVENTLERƒ∞
    document.getElementById('btnNext').onclick = () => showSlide(currentIndex + 1);
    document.getElementById('btnPrev').onclick = () => showSlide(currentIndex - 1);

    // MENU OLU≈ûTURMA
    const menuList = document.getElementById('menuList');
    slidesData.forEach((slide, i) => {
        const li = document.createElement('li');
        li.className = 'menu-item';
        li.innerText = slide.title;
        li.onclick = () => showSlide(i);
        menuList.appendChild(li);
    });

    // HARƒ∞TA FONKSƒ∞YONU (FIX)
    function initMap() {
        // Harita div'i g√∂r√ºn√ºr m√º kontrol et?
        const mapContainer = document.getElementById('raceMap');
        if (!mapContainer || mapContainer.offsetHeight === 0) return;

        // Harita zaten varsa boyutunu g√ºncelle, yoksa olu≈ütur
        if (map) {
            map.invalidateSize(); // BU KOMUT HAYAT KURTARIR
            return;
        }

        // Haritayƒ± ƒ∞lk Kez Olu≈ütur
        map = L.map('raceMap').setView([39.760, 30.525], 11);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19
        }).addTo(map);

        // Rota √áizgileri
        const route20k = [[39.760, 30.525], [39.750, 30.500], [39.740, 30.540], [39.760, 30.525]];
        L.polyline(route20k, {color: '#4caf50', weight: 4}).addTo(map).bindPopup("20K Parkuru");

        const route50k = [[39.760, 30.525], [39.720, 30.450], [39.680, 30.400], [39.700, 30.550], [39.760, 30.525]];
        L.polyline(route50k, {color: '#ff9800', weight: 4}).addTo(map).bindPopup("50K Parkuru");

        L.marker([39.760, 30.525]).addTo(map).bindPopup("Start/Finish: Odunpazarƒ±").openPopup();
    }

    // DASHBOARD EVENTLERƒ∞
    const eventContainer = document.getElementById('events-container');
    utmbEvents.forEach(evt => {
        const div = document.createElement('div');
        div.className = 'event-card';
        div.innerHTML = `<div style="font-weight:bold; color:white;">${evt.name}</div>
                         <div style="color:#aaa; font-size:12px;">${evt.location}</div>
                         <div style="color:#e94e1b; margin-top:auto;">üìÖ ${evt.date} <span style="float:right; font-size:10px; border:1px solid #444; padding:2px 5px; border-radius:4px;">${evt.tag}</span></div>`;
        eventContainer.appendChild(div);
    });

    // Ba≈ülangƒ±√ß
    showSlide(0);

  </script>
</body>
</html>